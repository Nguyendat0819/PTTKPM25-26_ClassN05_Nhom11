<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Thanh toán</title>
     <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zalando+Sans+Expanded:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <header class="header">
        <!-- Logo -->
        <div class="logo-shop">
            <a th:href="@{/user/home}">
                <img th:src="@{/images/logo-header.png}" alt="Diang Drink Logo" title="Trở về trang chủ">
            </a>
        </div>
    </header>
<div class="container my-5">
    <h2 class="text-center fw-bold text-success mb-4">Trang thanh toán</h2>

    <!-- Danh sách sản phẩm -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <h5 class="text-success mb-3">Sản phẩm của bạn</h5>
            <div class="table-responsive">
                <table class="table table-bordered align-middle text-center">
                    <thead class="table-success">
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Giá</th>
                            <th>Số lượng</th>
                            <th>Thành tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="detail : ${selectedDetails}">
                            <td th:text="${detail.productName}"></td>
                            <td th:text="${detail.productPrice}"></td>
                            <td th:text="${detail.quantity}"></td>
                            <td th:text="${detail.productPrice.multiply(T(java.math.BigDecimal).valueOf(detail.quantity.longValue()))}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <h5 class="text-end text-danger fw-semibold mt-3">
                Tổng cộng: <span th:text="${total}"></span> VNĐ
            </h5>
        </div>
    </div>

    <!-- Form thanh toán -->
    <div class="card shadow-sm">
        <div class="card-body">
            <h5 class="text-success mb-3">Thông tin giao hàng</h5>

            <form th:action="@{/user/checkout/doCheckout}" method="post">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Địa chỉ nhà:</label>
                    <input type="text" class="form-control" name="homeAddress"
                           th:value="${userAddress != null ? userAddress.homeAddress : ''}"
                           placeholder="Nhập địa chỉ cụ thể" required>
                </div>

                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Tỉnh / Thành phố:</label>
                        <select id="province" name="provinceId" class="form-select" required>
                            <option value="">-- Chọn Tỉnh/Thành --</option>
                            <option th:each="p : ${provinces}"
                                    th:value="${p.provinceId}"
                                    th:text="${p.name}"
                                    th:selected="${userAddress != null && userAddress.province?.provinceId == p.provinceId}">
                            </option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Quận / Huyện:</label>
                        <select id="district" name="districtId" class="form-select" required>
                            <option value="">-- Chọn Quận/Huyện --</option>
                        </select>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label class="form-label fw-semibold">Phường / Xã:</label>
                        <select id="ward" name="wardId" class="form-select" required>
                            <option value="">-- Chọn Phường/Xã --</option>
                        </select>
                    </div>
                </div>

                <h5 class="text-success mt-4 mb-2">Chọn phương thức thanh toán:</h5>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="paymentMethod" value="CASH" id="cash" checked>
                    <label class="form-check-label" for="cash">Tiền mặt</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="paymentMethod" value="MOMO" id="momo">
                    <label class="form-check-label" for="momo">Ví MoMo</label>
                </div>
                <div class="form-check mb-4">
                    <input class="form-check-input" type="radio" name="paymentMethod" value="CARD" id="card">
                    <label class="form-check-label" for="card">Thẻ ngân hàng</label>
                </div>

                <div class="text-center">
                    <button type="submit" class="btn btn-success px-4 py-2 fw-semibold">
                        Xác nhận thanh toán
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>


<!-- Footer -->
  <footer class="footer">
    <div class="footer-content">
      <div class="logo-footer">
        <a th:href="@{ #}">
          <img th:src="@{/images/logo-header.png}" alt="logo-footer" title="Diang Drink">
        </a>
      </div>
      <div class="about-diang">
        <h3 style="color: #333;">Về Diang Drink</h3>
        <p>Diang Drink cam kết mang đến cho bạn những trải nghiệm đồ uống tuyệt vời nhất với nguyên liệu tươi ngon và công thức độc đáo.</p>
        <a href="#">Nguồn gốc</a>
        <a href="#">Dịch vụ</a>
        <a href="#">Tuyển dụng</a>
        <a href="#">Liên hệ</a>
      </div>
      <div class="customer-support">
        <h3 style="color: #333;">Hỗ trợ khách hàng</h3>
        <a href="#">Chính sách đổi trả</a>
        <a href="#">Chính sách bảo mật</a>
        <a href="#">Điều khoản dịch vụ</a>
        <a href="#">Câu hỏi thường gặp</a>
      </div>
      <div class="system-store">
        <h3 style="color: #333;">Hệ thống cửa hàng</h3>
        <p>Hà Nội: 123 Đường A, Quận B</p>
        <p>Hồ Chí Minh: 456 Đường C, Quận D</p>
        <p>Đà Nẵng: 789 Đường E, Quận F</p>
        <p>Liên hệ: 0909 999 999</p>
      </div>
      <div class="follow-us">
        <h3>Theo dõi chúng tôi:</h3>
        <a href="#" class="social-media-icons"><img th:src="@{/images/tiktok.png}" alt="tiktok-icon" title="TikTok"></a>
        <a href="#" class="social-media-icons"><img th:src="@{/images/instagram.png}" alt="instagram-icon" title="Instagram"></a>
        <a href="#"class="social-media-icons"><img th:src="@{/images/facebook.png}" alt="facebook-icon" title="Facebook"></a>
        <a href="#"class="social-media-icons"><img th:src="@{/images/youtube.png}" alt="youtube-icon" title="YouTube"></a>
      </div>
    </div>
  </footer>


    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // Khi chọn Tỉnh/Thành phố
            $('#province').change(function() {
                var provinceId = $(this).val();
                if (provinceId) {
                    $.get('/api/districts?provinceId=' + provinceId, function(data) {
                        console.log("Districts returned:", data); 
                        var districtSelect = $('#district');
                        districtSelect.empty().append('<option value="">-- Chọn Quận/Huyện --</option>');
                        $('#ward').empty().append('<option value="">-- Chọn Phường/Xã --</option>');
                        $.each(data, function(i, district) {
                            districtSelect.append('<option value="' + district.districtId + '">' + district.name + '</option>');
                        });
                    });
                }
            });

            // Khi chọn Quận/Huyện
            $('#district').change(function() {
                var districtId = $(this).val();
                if (districtId) {
                    $.get('/api/wards?districtId=' + districtId, function(data) {
                        var wardSelect = $('#ward');
                        wardSelect.empty().append('<option value="">-- Chọn Phường/Xã --</option>');
                        $.each(data, function(i, ward) {
                            wardSelect.append('<option value="' + ward.wardId + '">' + ward.name + '</option>');
                        });
                    });
                }
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>


</body>
</html>
